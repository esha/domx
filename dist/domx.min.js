/*! domx - v0.9.1 - 2014-07-02
* http://esha.github.io/domx/
* Copyright (c) 2014 ESHA Research; Licensed MIT, GPL */
!function(D,_){"use strict";window.DOMxList=function(a){"number"==typeof a?(this.limit=a,this.add(_.slice(arguments,1))):this.add(arguments)},_={version:"0.9.1",slice:Array.prototype.slice,zero:function(){return 0},nodes:[Element,Text,Comment],lists:[NodeList,HTMLCollection,DOMxList],isList:function(a){return a&&"object"==typeof a&&"length"in a&&!a.nodeType||a instanceof NodeList||a instanceof HTMLCollection},define:function(a,b,c,d){if("string"==typeof b)for(var e=0,f=a.length;f>e;e++)_.defprop(a[e].prototype||a[e],b,c,d);else for(var g in b)_.define(a,g,b[g],c)},defprop:function(a,b,c,d){if(d||!(b in a))try{var e=c.get||c.set?c:{value:c,writable:!0};e.configurable=!0,Object.defineProperty(a,b,e)}catch(f){}},resolve:function(a,b,c,d){var e=a,f=b;if(c=c.length?_.fill(c,d,f):null,e.indexOf(".")>0){for(var g=e.split(".");g.length>1&&(f=f[e=g.shift()]););f=f||b,e=f?g[0]:a}var h=f[e];if(void 0!==h){if("function"==typeof h&&h.apply)return h.apply(f,c);if(!c)return h;f[e]=c[0]}else if(1===b.nodeType){if(!c)return b.getAttribute(a);null===c[0]?b.removeAttribute(a):b.setAttribute(a,c[0])}},fill:function(a,b,c){for(var d=[],e=0,f=a.length;f>e;e++){var g=a[e],h=typeof g;d[e]="string"===h?g.replace(/\$\{i\}/g,b):"function"===h?g(c,b,a):g}return d}},_.defprop(D,"_",_),_.define([Node].concat(_.lists),{each:function(a){var b,c,d=_.isList(this)?this:[this],e=[];"string"==typeof a&&(b=_.resolve[a]||a,c=_.slice.call(arguments,1),a=function(a,d){return _.resolve(b,a,c,d)});for(var f,g=0,h=d.length;h>g;g++)f=a.call(d[g],d[g],g,d),(f||b&&void 0!==f)&&e.push(f);return e.length?_.isList(this)?e[0]&&e[0].each?new DOMxList(e):e:e[0]:this},toArray:function(a){if(a=a||[],_.isList(this))for(var b=0,c=this.length;c>b;b++)a.push(this[b]);else a.push(this);return a}}),_.define([DOMxList],{length:0,limit:-1,add:function(a){var b=this.length;if(arguments.length>1||_.isList(a))for(var c=arguments.length>1?arguments:a,d=0,e=c.length;e>d;d++)this.add(c[d]);else null!==a&&void 0!==a&&this.indexOf(a)<0&&(this[this.length++]=a,this.length===this.limit&&(this.add=_.zero));return this.length-b},indexOf:function(a){for(var b=0;b<this.length;b++)if(a===this[b])return b;return-1}}),_.defprop(D,"extend",function(a,b,c,d){Array.isArray(c)||(d=c,c=[Element]),_.define(c,a,b,d),_.define(_.lists,a,function(){var a=arguments;return this.each(function(){return b.apply(this,a)})},d)}),_.parents=[Element,DocumentFragment,D],_.define(_.parents.concat(_.lists),{queryAll:function(a,b){for(var c=_.isList(this)?this:[this],d=new DOMxList(b),e=0,f=c.length;f>e&&(!b||b>d.length);e++)d.add(c[e][b===d.length+1?"querySelector":"querySelectorAll"](a));return d},query:function(a){return this.queryAll(a,1)[0]}}),_.define(_.lists,{only:function(a,b){var c=this.toArray();return c=a>=0||0>a?c.slice(a,b||a+1||void 0):c.filter("function"==typeof a?a:1===arguments.length?function(b){return b[b.matches?"matches":"hasOwnProperty"](a)}:function(c){return(c.each?c.each(a):c[a])===b}),new DOMxList(c)},not:function(){var a=this.only.apply(this,arguments);return this.only(function(b){return a.indexOf(b)<0})}}),_.utmost=function(a,b,c){return a&&(a=a[b])?_.utmost(a,b,a):c||a},_.define(_.nodes,"utmost",function(a){return _.utmost(this,_.resolve[a]||a)}),D.extend("all",function(a,b,c,d){b===!0&&(c=b,b=void 0),d=d||new DOMxList;var e=c?this:this[_.resolve[a]||a];if(e){var f=b&&b.call(this,e,d);null!==f&&d.add(f||e),!e.all||!e.length&&_.isList(e)||e.all(a,b,!1,d)}return d},[Node]);var Ep=Element.prototype,aS="atchesSelector";_.defprop(Ep,"matches",Ep.m||Ep["webkitM"+aS]||Ep["mozM"+aS]||Ep["msM"+aS]);var A=_.append={create:function(a,b,c){return A.insert(a,D.createElement(b),c)},insert:function(a,b,c){var d=A.find(a,c);return d?a.insertBefore(b,d):a.appendChild(b),b},find:function(a,b){switch(typeof b){case"string":return a[b]||a.only(b);case"number":return a.children[b];case"object":return b;case"function":return b.call(a,a)}}};D.extend("append",function(a,b){if("string"==typeof a)return A.create(this,a,b);if(_.isList(a)){for(var c=new DOMxList,d=0,e=a.length;e>d;d++)c.add(this.append(a[d],b));return c}return A.insert(this,a,b),a},_.parents),D.extend("remove",function(){var a=this.parentNode;a&&a.removeChild(this)},_.nodes);var V=_.values={resolve:function(context,reference){return eval("context"+("["!==reference.charAt(0)?"."+reference:reference))},parse:function(a){if("string"==typeof a)try{a=JSON.parse(a)}catch(b){}else Array.isArray(a)&&(a=a.map(V.parse));return a},string:function(a){if(void 0!==a&&"string"!=typeof a)try{a=JSON.stringify(a)}catch(b){a+=""}return a},stringifyFor:function(a){var b=a.getAttribute("data-values-stringify");return b&&V.resolve(window,b)||V.string},nameNodes:function(a,b,c,d){for(var e=[],f=0;f<a.childNodes.length;f++){var g=a.childNodes[f],h=g.name,i=null;if(h&&e.indexOf(g)<0?(e.push(g),i=b(h,g)):c&&!g.useBaseValue()&&c(g),g.useAttrValues)for(var j=0;j<g.attributes.length;j++)d(g.attributes[j],i)}},combine:function(a,b){return void 0===a||a===b?b:Array.isArray(a)?(a.indexOf(b)<0&&a.push(b),a):[a,b]},getNameValue:function(a,b){return V.nameNodes(a,function(a,c){return b[a]=V.combine(b[a],c.nameValue)},function(a){V.getNameValue(a,b)},function(a,c){var d=c||b;d[a.name]=a.baseValue}),b},setNameValue:function(a,b){V.nameNodes(a,function(a,c){var d=V.resolve(b,a);return void 0!==d?c.nameValue=d:void 0},function(a){V.setNameValue(a,b)},function(a,c,d){var e=V.resolve(d||b,a.name);void 0!==e&&(a.baseValue=e)})},booleanAttr:function(a){return{get:function(){return this.hasAttribute(a)},set:function(b){this[b?"setAttribute":"removeAttribute"](a,!0)}}},nameRE:/\$\{([^}]+)\}/};_.define([Node],{value:{get:function(){return this.hasAttribute&&this.hasAttribute("value")?this.getAttribute("value"):this.textContent},set:function(a){this.hasAttribute&&this.hasAttribute("value")?this.setAttribute("value",a):this.textContent=a}},baseValue:{get:function(){return V.parse(this.value)},set:function(a){this.value=V.string(a)}},useBaseValue:function(){var a=!this.noValues&&this.childNodes.length;return!a||1===a&&!!this.childNodes[0].useBaseValue()},properValue:{get:function(){return this.useBaseValue()?this.baseValue:V.getNameValue(this,{})},set:function(a){this.useBaseValue()||"object"!=typeof a?this.baseValue=a:V.setNameValue(this,a)}},nameParent:{get:function(){for(var a,b=this;a=b.parentNode;){if(a.name)return a;b=a}return b===this?null:b}},nameGroup:{get:function(){var a=this,b=a.name;return b?a.parentNode?a.nameParent.queryNameAll(b):new DOMxList(a):null}},nameValue:{get:function(){var a;return this.name&&this.nameGroup.each(function(b){a=V.combine(a,b.properValue)}),a||this.properValue},set:function(a){if(this.name&&Array.isArray(a)){var b=this.nameGroup;for(a.length||!b.length||b[0].hasAttribute(R.id)||R.init(b[0],!0),b.each(function(b,c){c<a.length?b.nameValue=a[c]:b.remove()});b.length<a.length;){var c=b[b.length-1];b.add(c.repeat(a[b.length]))}}else this.properValue=a}}}),_.define([Attr],{useBaseValue:function(){return!0}},!0),_.define([Element],{name:{get:function(){return this.getAttribute("name")},set:function(a){this.setAttribute("name",a)}},baseValue:{get:function(){var a=this.getAttribute("data-values-parse");return a=a&&V.resolve(window,a)||V.parse,a.call(this,this.value)},set:function(a){this.value=V.stringifyFor(this).call(this,a)}},useAttrValues:V.booleanAttr("data-values-attr"),noValues:V.booleanAttr("data-values-none")},!0),_.define(_.parents,{queryName:function(a){return this.queryNameAll(a,!1)},queryNameAll:function(a,b){b=void 0===b?new DOMxList:b;for(var c=0;c<this.childNodes.length;c++){var d,e=this.childNodes[c],f=e.name;if(f===a&&"X-REPEAT"!==e.tagName){if(!b)return e;b.add(e)}else if(1===e.nodeType)if(f){if(0===a.indexOf(f+".")&&(d=e.queryNameAll(a.substring(f.length+1),b),b!==d))return d}else if(d=e.queryNameAll(a,b),b!==d)return d}if(this.useAttrValues)for(var g=this,h=0;h<g.attributes.length;h++){var i=g.attributes[h];if(i.name===a){if(!b)return i;i.parentNode=g,b.add(i)}}return b}}),_.define([Text],{useBaseValue:function(){return!!this.noValues||!this.splitOnName()},splitOnName:function(){var a=this,b=a.value.match(V.nameRE);if(b){var c=b.index,d=b[0];return c>0&&(a.splitText(c),a.noValues=!0,a=a.nextSibling),a.value.length>d.length&&a.splitText(d.length),a.name=b[1],a.value="",a}this.noValues=!0}},!0),_.define([HTMLInputElement],{properValue:{get:function(){var a=this;return"radio"!==a.type&&"checkbox"!==a.type||a.checked?a.baseValue:null},set:function(a){var b=this;"checkbox"===b.type?(a=(Array.isArray(a)?a:[a]).map(V.stringifyFor(this)),b.checked=a.indexOf(b.value)>=0):this.baseValue=a}},nameValue:{get:function(){var a=this.type;if("radio"===a||"checkbox"===a){var b,c=this.nameGroup;return c.each(function(a){b=V.combine(b,a.properValue)}),!Array.isArray(b)||"radio"!==this.type&&1!==c.length?b:b[0]}return this.properValue},set:function(a){"checkbox"===this.type?(a=(Array.isArray(a)?a:[a]).map(V.stringifyFor(this)),this.nameGroup.each(function(b){b.checked=a.indexOf(b.value)>=0})):this.properValue=a}}},!0),_.define([HTMLSelectElement],{properValue:{get:function(){if(this.multiple){var a=this.children.only("selected",!0);return a.length?a.each("properValue"):this.children.length>1?[]:null}return V.parse(this.value)},set:function(a){this.multiple?(a=(Array.isArray(a)?a:[a]).map(V.string),this.children.each(function(b){a.indexOf(b.value)>=0&&(b.selected=!0)})):this.value=V.string(a)}}},!0);var R=_.repeat={id:"data-repeat-id",count:0,init:function(a,b){var c=a.getAttribute("data-repeat"),d=R.count++,e=c&&D.query(c).cloneNode(!0)||a,f=D.createElement("x-repeat");e.setAttribute(R.id,d),f.setAttribute(R.id,d);for(var g=0,h=a.attributes.length;h>g;g++){var i=a.attributes[g];"data-repeat-none"===i.name&&(f.value=i.value||a.innerHTML),f.setAttribute(i.name,i.value)}return a.parentNode.insertBefore(f,a.nextSibling),_.defprop(f,"source",e),b!==!0&&a.remove(),d},repeat:function(a,b,c,d){var e=c.cloneNode(!0);return void 0!==d&&null!==d&&(e.properValue=d),a.insertBefore(e,b),e},style:D.head.append("style")};D.extend("repeat",function(a){var b=this.parentNode,c=this.getAttribute(R.id)||R.init(this,!0),d="["+R.id+'="'+c+'"]',e=d+":not(x-repeat)";if(a===!1)return b.queryAll(e).remove();var f=b.query("x-repeat"+d),g=f.source;f.hasAttribute("data-repeat-first")&&(f=b.query(d+"[data-index]")||f);var h=Array.isArray(a)?a.map(function(a){return R.repeat(b,f,g,a)}):R.repeat(b,f,g,a);return b.queryAll(e).each("setAttribute","data-index","${i}"),h}),R.style.value="[data-repeat] { display: none }",D.addEventListener("DOMContentLoaded",function(){D.queryAll("[data-repeat]").each(R.init),R.style.value="\nx-repeat { display: none }\nx-repeat[data-repeat-none] { display: inline-block; }\n["+R.id+"] + x-repeat[data-repeat-none] { display: none; }"});var AE=_.append;AE.create=function(a,b,c){var d=b.split(AE.emmetRE()),e=D.createDocumentFragment(),f=D.createElement(d[0]);e.appendChild(f);for(var g=1,h=d.length;h>g;g++){var i=d[g];f=AE.emmet[i.charAt(0)].call(f,i.substr(1),e)||f}return AE.insert(a,e,c),f},AE.emmetRE=function(){var a="\\"+Object.keys(AE.emmet).join("|\\");return new RegExp("(?="+a+")","g")},AE.emmet={"#":function(a){this.id=a},".":function(a){var b=this.getAttribute("class")||"";b=b+(b?" ":"")+a,this.setAttribute("class",b)},"[":function(a){a=a.substr(0,a.length-1).match(/(?:[^\s"]+|"[^"]*")+/g);for(var b=0,c=a.length;c>b;b++){var d=a[b].split("=");this.setAttribute(d[0],(d[1]||"").replace(/"/g,""))}},">":function(a){if(a){var b=D.createElement(a);return this.appendChild(b),b}return this},"+":function(a,b){return AE.emmet[">"].call(this.parentNode||b,a)},"*":function(a){for(var b=this.parentNode,c=new DOMxList(this),d=1;a>d;d++)c.add(this.cloneNode(!0)),b.appendChild(c[d]);return c},"^":function(a,b){return AE.emmet["+"].call(this.parentNode||b,a,b)},"{":function(a){this.appendChild(D.createTextNode(a.substr(0,a.length-1)))}},_.defprop(D,"html",D.documentElement);var dot=_.dot={names:{3:"$text",8:"$comment",7:"$procins"},fns:{},fn:function(a,b){return dot.fns[b]||(dot.fns[b]=1===a?function(){return this.each("children").only(b).dot()}:function(){return this.each("childNodes").only("nodeType",a)})},init:function(){D.queryAll("[data-domx-dot]").each(function(a){a.dot(!0),Observer&&!a._observer&&(a._observer=new Observer(function(a){for(var b=0,c=a.length;c>b;b++)a[b].target.dot(!0)})).observe(a,{childList:!0,subtree:!0})})}},Observer=window.MutationObserver;_.define(_.parents.concat(_.lists),"dot",function(a){var b=this;return(a||!b._dotted)&&(b.each("childNodes").each(function(a){var c=a.nodeType,d=dot.names[c]||a.tagName.toLowerCase();d in b||_.defprop(b,d,{get:dot.fn(c,d)}),1===c&&a.dot()}),_.defprop(b,"_dotted",!0)),b}),dot.init(),D.addEventListener("DOMContentLoaded",dot.init)}(document);